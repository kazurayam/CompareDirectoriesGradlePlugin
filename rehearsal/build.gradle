plugins {
    id "com.kazurayam.compare-directories"
}

ext {
    fixturesDir = "../plugin/src/test/fixtures"
    outDir = "build/out"
}

// The com.kazurayam.compare-directories plugin registeres a task named 'compareDirectories'
compareDirectories {
    dirA = layout.projectDirectory.dir("${fixturesDir}/A")
    dirB = layout.projectDirectory.dir("${fixturesDir}/B")
    outputFile = layout.buildDirectory.file("${outDir}/differences.json")
    diffDir = layout.buildDirectory.dir("${outDir}/diff")
}

// or you can register a task with name you like, which calls the CompareDirectoriesTask
tasks.register('dircomp', com.kazurayam.dircomp.CompareDirectoriesTask) {
    dirA = layout.projectDirectory.dir("${fixturesDir}/A")
    dirB = layout.projectDirectory.dir("${fixturesDir}/B")
    outputFile = layout.buildDirectory.file("${outDir}/differences.json")
    diffDir = layout.buildDirectory.dir("${outDir}/diff")
}

task cleanDircomp {
    doFirst {
        delete(outDir)
        mkdir(outDir)
        println "initialized ${outDir}"
    }
    doLast {
        println "comparing ${fixturesDir}/A and ${fixturesDir}/B"
        compareDirectories {
            dirA = layout.projectDirectory.dir("${fixturesDir}/A")
            dirB = layout.projectDirectory.dir("${fixturesDir}/B")
            outputFile = layout.buildDirectory.file("${outDir}/differences.json")
            diffDir = layout.buildDirectory.dir("${outDir}/diff")
        }
        println "output into ${outDir}/differences.json"
    }
}